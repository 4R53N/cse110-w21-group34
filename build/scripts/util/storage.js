import*as Constants from"../constants.js";export const BEST_DAILY_POMO_ID="best-daily-pomo-count";export const TOTAL_POMO_ID="total-pomo-count";export const TOTAL_TASK_ID="total-task-count";export const TODAY_TASK_ID="today-task-count";export const WEEK_HISTORY="week-history";export const TODAY_DATE_ID="today";export const WEEK_START_ID="week-start";export const TODAY_POMO_ID="today-pomo-count";export const TOTAL_CYCLE_ID="total-cycle-count";export const TOTAL_INTERRUPTION="total-interruption";export const TODAY_INTERRUPTION="today-interruption";export const ZEROS=[0,0,0,0,0,0,0];export function setCounter(t,e){window.localStorage.setItem(t,String(e))}export function setDate(t,e){window.localStorage.setItem(t,e.toString())}export function setWeekHistory(t){window.localStorage.setItem(WEEK_HISTORY,JSON.stringify(t))}export function getCounter(t){return Number(window.localStorage.getItem(t))}export function getDate(t){return new Date(window.localStorage.getItem(t)||new Date(0))}export function getWeekHistory(){return JSON.parse(window.localStorage.getItem(WEEK_HISTORY))||ZEROS}export function incrTasks(){updateStorage(),setCounter(TODAY_TASK_ID,getCounter(TODAY_TASK_ID)+1),setCounter(TOTAL_TASK_ID,getCounter(TOTAL_TASK_ID)+1)}export function incrPomoCount(){updateStorage();const t=getCounter(TODAY_POMO_ID)+1;setCounter(TODAY_POMO_ID,t),setCounter(TOTAL_POMO_ID,getCounter(TOTAL_POMO_ID)+1),getCounter(BEST_DAILY_POMO_ID)<t&&setCounter(BEST_DAILY_POMO_ID,t);const e=((new Date).getDay()-1)%Constants.LENGTH_OF_WEEK,o=getWeekHistory();o[e]++,setWeekHistory(o)}export function incrInterruptions(){updateStorage(),setCounter(TODAY_INTERRUPTION,getCounter(TODAY_INTERRUPTION)+1),setCounter(TOTAL_INTERRUPTION,getCounter(TOTAL_INTERRUPTION)+1)}export function updateStorage(){if(!isStorageDateToday()){setCounter(TODAY_POMO_ID,0),setCounter(TODAY_TASK_ID,0),setCounter(TODAY_INTERRUPTION,0);const t=new Date;setDate("today",t);const e=getRecentMonday(t);isSameDay(getDate("week-start"),e)||(setDate("week-start",e),setWeekHistory(ZEROS))}}export function isStorageDateToday(){return isSameDay(new Date,getDate("today"))}export function isSameDay(t,e){const o=t.getDate()===e.getDate(),n=t.getMonth()===e.getMonth(),r=t.getFullYear()===e.getFullYear();return o&&n&&r}export function getRecentMonday(t){const e=new Date(t);for(;1!==e.getDay();)e.setDate(e.getDate()-1);return e}