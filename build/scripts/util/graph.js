import{isA11yEnabled}from"../accessibility.js";import{ZEROS}from"./storage.js";const X_LABELS=["M","T","W","Th","F","Sa","Su"],Y_LABEL="Pomos Completed",INITIAL_Y_AXES=[0,1,2,3],TEXT_ALIGN_CENTER="center",TEXT_FONT="12px Roboto",TEXT_FONT_ACCESSIBILITY="bold 15px Roboto",BAR_COLOR="#eb4000",BAR_COLOR_ACCESSIBILITY="#B50014",BAR_WIDTH=20,BAR_PADDING=12,BAR_LEFT_MARGIN=24,TEXT_HEIGHT=14,TOP_PADDING=16,RIGHT_PADDING=16,BOTTOM_PADDING=32,LEFT_PADDING=48,FILL_TEXT_X_PAD=16,FILL_TEXT_Y_PAD=4,X_LABEL_HEIGHT_PAD=8,Y_MIN_SPACING=3,Y_MAX_SPACING=11,TWO=2,TEST_PROCESS="test",CONTEXT_2D="2d";export function drawGraph(t,e=ZEROS){if(!t||"object"==typeof process&&"test"===process.env.NODE_ENV)return;const o=t.getContext("2d"),r=calculateAxes(e);o.clearRect(0,0,t.width,t.height),drawAxes(o,t.height,t.width,r),drawBars(o,t.height,e,r),o.save()}function drawAxes(t,e,o,r){const n=e-32,s=o-16;t.font=isA11yEnabled()?"bold 15px Roboto":TEXT_FONT,t.textAlign="center";for(const[e,o]of r.entries()){const T=48,a=16+n-Math.round(n*(e/(r.length-1)));drawLine(t,T,a,s,a),t.fillText(o,T-16,a+4)}t.save(),t.translate(16,Math.round((16+n)/2)),t.rotate(-Math.PI/2),t.fillText(Y_LABEL,0,0),t.restore();for(const[e,o]of X_LABELS.entries()){const r=72+32*e,s=16+n+8+7;t.fillText(o,r,s)}drawLine(t,48,0,48,16+n)}export function calculateAxes(t){const e=INITIAL_Y_AXES.slice();let o=Math.max(...t);if(o<3)return e;for(o>=11&&o++,o++;o%3!=0;)o++;let r=1;return e[r++]=o/3,e[r++]=2*o/3,e[3]=o,e}function drawBars(t,e,o,r){const n=Math.max(...r),s=e-32;for(const[e,r]of o.entries()){const o=Math.round(s*(r/n));if(o>0){drawBar(t,72+32*e,16+s-o,20,o,isA11yEnabled()?"#B50014":"#eb4000")}}}function drawBar(t,e,o,r,n,s){t.save(),t.fillStyle=s,t.fillRect(e-Math.round(r/2),o,r,n),t.restore()}function drawLine(t,e,o,r,n){t.beginPath(),t.moveTo(e,o),t.lineTo(r,n),t.stroke()}